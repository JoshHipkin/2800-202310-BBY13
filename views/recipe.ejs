<%- include(`templates/header${headerSession}`) %> 
<div class="p-4 mb-3 bg-body-tertiary rounded">
  <h1 class="fst-italic"><%= recipe.name %></h1>
  <% for(count = 0; count < filteredRatings.length; count++) { %>
    <% if(filteredRatings[count].recipeID == recipe._id) { %>
      <p>Rating: <%-((filteredRatings[count].rating) / (filteredRatings[count].ratingTotal)).toFixed(1)%>/5.0 (based on <%-filteredRatings[count].ratingTotal%> reviews)</p>
    <% } else { %>
      <p>No reviews</p>
    <% } %>
  <% } %>
  <div class= "py-5">
    <h4 class>Ingredients:</h4> 
    <p class="mb-0">
      <ul>
          <% const ingredients_raw_str = recipe.ingredients_raw_str.split(','); %>
          <% for(let i=0; i < ingredients_raw_str.length; i++) { %>
          <% const ingredient_raw = ingredients_raw_str[i].trim().replace(/^\[|\]$/g, '').replace(/^"|"$/g, ''); %>
            <li><%= ingredient_raw  %></li>
          <% } %>
      </ul>
    </p>
  </div>
  <h4 class="fst-italic">Instructions:</h4>
  <p class="mb-0">
      <ol>
          <% const steps = recipe.steps.split(/[;.]/); %>
          <% for(let i=0; i < steps.length; i++) { %>
            <% const step = steps[i].trim().replace(/\[|\]|'|,/g, ''); %>
            <% if (step) { %>
              <li><%= step %></li>
            <% } %>
          <% } %>
      </ol>
  </p>
  <form action='/commentPost' method='post'>
    <h4 class="fst-italic">Comments:</h4>
    <p class="fst-italic">Rating</p>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="rating" id="rating" value="1">
      <label class="form-check-label" for="rating">1</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="rating" id="rating" value="2">
      <label class="form-check-label" for="rating">2</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="rating" id="rating" value="3">
      <label class="form-check-label" for="rating">3</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="rating" id="rating" value="4">
      <label class="form-check-label" for="rating">4</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="rating" id="rating" value="5">
      <label class="form-check-label" for="rating">5</label>
    </div>
    <div class="form-floating mb-2">
        <input name='commentHeader' type='text' class="form-control" placeholder="Review Title" required>
        <label for="commentHeader">Review Title</label>
    </div>
    <div class="form-floating mb-2">
      <input name='comment' type='text' class="form-control" placeholder="Comment" required>
      <label for="comment">Add a comment...</label>
    </div>
    <div class="form-floating mb-2">
      <input name='idRecipe' type='text' class="form-control" placeholder="idRecipe" value="<%- recipe._id.toString() %>" hidden>
      <label for="idRecipe" hidden><label>
  </div>
    <button type="submit" class="w-20 btn btn-primary">Comment</button>
</form>


<% for (count = 0; commentData.length > count; count++){ %>
  <form>
    <div class="form-floating mb-2">
      <h5 style="margin-top: 10px; margin-bottom: 0px;"><%-commentData[count].commentHeader%></h5>
      <% if(commentData[count].rating == null) { %>
        <p style="margin-bottom: 0px;">No rating</p>
      <% } else { %>
        <p style="margin-bottom: 0px;"><%-commentData[count].rating %> out of 5</p>
      <% } %>
      <p style="margin-bottom: 0px;">Review by <%-commentData[count].username%></p>
      <textarea type="text" class="form-control" disabled><%-commentData[count].comment%></textarea>
    </div>
</form>
<% } %>

</div>
<%- include(`templates/footer${headerSession}`) %>



